# Workshop по событийной архитектуре

Для генерации приложений используем nextgen

```
gem exec nextgen create inbox
```

## Архитектура

Приложение состоит из 7 приложений:

- inbox
- check-manager
- tesseract
- yandex-vision
- check-ruler
- budget-control
- check-register

В качестве исходного дата-объекта выступает письмо с вложением (товарным чеком), которое читает первый микросервис inbox. Далее вложение проходит через цепочку микросервисов, подвергается распознаванию и в конце-концов регистрируется в микросервисе check-register.

Диаграмма компонентов по совместительству является и диаграммой развертывания:

![Диаграмма компонентов](docs/components.png)

## Вспомогательные папки проекта

Некоторые папки не используются непосредственно для запуска приложения:

- docs — файлы и материалы для документирования проекта
- microservice-template — генератор микросвервисов, при помощи которого создавались все микросервисы, за исключением inbox
- tesseract-docker — тестовый проект, для демонстрации распознавание изображений при помощи tesseract (а также инструкция по его установке и использованию)
- yandex-vision-osr - тестовый проект, для демонстрации распознавания изображений при помощи Yandex Vision OSR и (а также инструкция по его использованию)

## Запуск проекта

1. В семи основных проектах необходимо скопировать sample.env в .env и корректно заполнить переменные окружения
2. В корне репозитория следует запустить команду

```
docker compose up
```

3. Для каждого проекта, использующего базу данных необходимо выполнить команду для ее создания и развертывания

```
docker compose run НАЗВАНИЕ_СЕРВИСА bundle exec rake db:drop db:create db:migrate
```

НАЗВАНИЕ_СЕРВИСА это одно из семи значений: inbox, check-manager, check-ruler, check-register, budget-control. Впрочем их можно всегда посмотреть в docker-compose.yaml.

Кроме того, каждый микросервис можно запустить отдельно от остальных, воспользовавашись readme.md файлом в папке микросервиса.
