# 7: Срок действия сообщений

Дата: 2025-09-15

## Статус

Принят

## Проблема

Начальное вложение сохраняется в S3-хранилище. Если, разные микросервисы обращаются к одному и тому же хранилищу, мы увеличиваем связанность микросервисов единым хранилищем. Изменение формата и правил обработки файлов в хранилище затрагивает сразу несколько микросервисов.

## Решение

Получив вложение, мы сохраняем его в S3-хранилище. Далее у нас есть выбор: мы либо получаем временную ссылку и передаем ее дальше, либо передаем ключ файла в S3-хранилище. Временный файл имеет срок жизни и сообщение с таким файлом не имеет смысла в системе, если оно обрабатывается дольше, чем временный файл. Поэтому желательно использовать время действия сообщения, после которого оно должно отбрасываться и перестать обрабатываться. Однако, у нас имеется панель BudgetControll, где обработка файлов происходит в ручном режиме. Срок обработки товарного чека в ручном режиме не ограничен, поэтому работать с временными ссылками нам будет не удобно. Идем на компромисс и снабжаем все микросервисы S3-доступом к бакету с файлами. Это позволит не опасаться истечения срока действия ссылки на файл и устраняет необходимость реализации шаблона "Срок действия сообщения".

## Заключение

Не используем в сообщениях временные ссылки на файлы и не реализуем механизм срок действия сообщения
