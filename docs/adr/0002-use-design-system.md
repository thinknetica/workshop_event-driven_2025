# 3: Используем брокер сообщений RabbitMQ

Date: 2025-07-10

## Стаус

Принят

## Проблема

Цель данного приложения: продемонстрировать приемы микросервисной архитектуры. Для того, чтобы построить микросервисную архитектуру, необходимо выбрать брокер-сообщений, который будет использован для организации каналов связи.

В случае принятия решения в пользу одного из брокеров сообщений, необходимо утвердить гемы, при помощи которых мы обращаемся к тому или иному брокеру.

## Решение

Если не опираться на облачные решения, то из современных брокеров сообщений, популярных в Ruby on Rails сообществе можно выделить два:

- **RabbitMQ** — брокер сообщений первого поколения, написанный на Erlang, среди достоинств, малое потребление ресурсов, встроенная панель управления, широкая поддержка возможностей событийной архитектуры (например поддержка exchange и dead-letter-queue из коробки). Из недостатков, можно отметить проблемы с производительностью, при напливании миллионов сообщений в брокере.
- **Apache Kafka** - броке сообщений второго поколения, написанный на Java. Среди достоинств, поддержка высокой производительности, хранение сообщений за произвольный период (хоть с начала эксплуатации). Из недостатков можно отметить неудачную начальную конфигруацию, которая может послужить причиной инцидентов, высокое потребление ресурсов, внешнюю систему кластеризации на базе ZooKeeper, внешнюю панель управления (RedPanda), отсутствие поддержки множества приемов EventDriven, часто вынесенные в отдельные фреймворки.

У нас слабый поток данных, поэтому нет необходимости в мощном брокере сообщений Apache Kafka. Кроме того, наша цель посмотреть как можно больше паттернов проектирования EventDriven. Поэтому RabbitMQ для наших целей нам подходит больше.

Наиболее популярный гем для отправки сообщений в RabbitMQ, это [bunny](https://github.com/ruby-amqp/bunny). Он кстати, интенсивно используется в официальном [туториале](https://www.rabbitmq.com/tutorials).

Для прослушивания каналов RabbitMQ чаще используется гем [sneakers](https://github.com/jondot/sneakers). К сожалению, репозиторий заброшен, поэтому используется fork в виде гема [kicks](https://github.com/ruby-amqp/kicks). На него и будем опираться в работе.

## Заключение

Используем RabbitMQ. Для отправки сообщений используем гем bunny, для приема - kicks (форк sneakers).
