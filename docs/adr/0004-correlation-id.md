# 4: Сквозной идентификатор (correlation-id)

Date: 2025-09-11

## Стаус

Принят

## Проблема

В EventDriven-архитектуре часто участвует большое количество микросевисов с собстенными базами данных. Между отдельными микросервисами через каналы передаются сообщения и их состав определяется содержимым базы данных данного сообщения. 

В результате в потоке сообщений трудно найти сообщения, которые относятся к определеной бизнес-транзакции. Это бывает необходимо для отладки, или отслеживания маршрута и времени обработки data-объекта.

## Решение

Чтобы отследить весь путь начального data-объекта от точки входа до завершения бизнес-транзакции необходим какой-то идентификатор внутри сообщения, который будет оставаться постоянным из сообщения в сообщение.

Это позволит отфильтровать сообщения среди множества других, извлечь сообщения относящиеся только к текущей бизнес-транзакции и выстроить их в хронологическом или логическом порядке. В результате можно будет легко отследить как обрыв обработки и локализовать сбойный участок EventDriven-цепочки, так и оценить время, за которое сообщение пробегает путь от начала до конца.

К нам поступает письмо, которое содержит влолжения, содержимое письма разбивается на такое количество сообщений, сколько вложений внутри письма. Далее вложение по мере вычисления преобразуется в распознанный текст, из которого потом извлекается сумма, которая в конечном итоге доходит до финишного микросервиса. Т.е. прородителем сообщения в системе выступает вложение.

Давайте договоримся, что в каждом сообщении внутри системы будет ключ attachment_id с идентификатором вложения в самом первом микросервисе inbox. Т.е. attachment_id будет выступать сквозным идентификатором (correlation-id) нашей системы.

Так как генератором идентификаторов у нас выступает PostgreSQL, причем в качестве типа мы везде задаем uuid, то значением attachment_id будет 128-битный uuid-ключ формата: 550e8400-e29b-41d4-a716-446655440000. Значение передается как строковое.

## Заключение

В качестве сквозного идентификатора используется 128-битныйы uuid-ключ attachment_id, создаваемый лишь в одном месте: inbox.
